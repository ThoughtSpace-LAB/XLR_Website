---
// SerenaLetter 组件 - 包含六个字母和滚动动画效果
---

<!-- 六个英语字母居中布置 -->
<div class="absolute z-30 h-full w-[15%] place-content-start cursor-none pt-[20vh] pb-[40vh] md:py-[15vh]">
<div id="serena-letters" 
class="cursor-none w-full max-w-4xl mx-auto h-full grid grid-cols-2 grid-rows-3 z-30 place-items-start">
  <div class="letter-wrap " data-letter="S">
    <h1 class="headline-md scramble-target animate-letter letter-container" style="animation-delay: 0s">
      <span class="letter-text">S</span>
    </h1>
  </div>
  <div class="letter-wrap" data-letter="E">
    <h1 class="headline-md scramble-target animate-letter letter-container" style="animation-delay: 0s">
      <span class="letter-text">E</span>
    </h1>
  </div>
  <div class="letter-wrap" data-letter="R">
    <h1 class="headline-md scramble-target animate-letter letter-container" style="animation-delay: 0.2s">
      <span class="letter-text">R</span>
    </h1>
  </div>
  <div class="letter-wrap" data-letter="E">
    <h1 class="headline-md scramble-target animate-letter letter-container" style="animation-delay: 0.2s">
      <span class="letter-text">E</span>
    </h1>
  </div>
  <div class="letter-wrap" data-letter="N">
    <h1 class="headline-md scramble-target animate-letter letter-container" style="animation-delay: 0.4s">
      <span class="letter-text">N</span>
    </h1>
  </div>
  <div class="letter-wrap" data-letter="A">
    <h1 class="headline-md scramble-target animate-letter letter-container" style="animation-delay: 0.4s">
      <span class="letter-text">A</span>
    </h1>
  </div>
</div>
</div>

<script>
  if (typeof window !== 'undefined') {
    const grid = document.getElementById('serena-letters');
    if (grid) {
      const wraps = Array.from(grid.querySelectorAll('.letter-wrap')) as HTMLDivElement[];
      const speed = 1.2; // scroll speed factor
      const maxOffset = 80; // max translate in px at one viewport height
      const fadeStart = 0; // 开始淡出的滚动进度
      const fadeEnd = 0.3; // 完全消失的滚动进度

      const handleScroll = () => {
        const progress = window.scrollY / window.innerHeight; // 0 at top, ~1 after one viewport
        const baseOffset = Math.min(progress * maxOffset * speed, maxOffset * speed);

        // 计算透明度 (1 到 0，从完全可见到消失)
        const opacity = Math.max(0, Math.min(1, 1 - (progress - fadeStart) / (fadeEnd - fadeStart)));

        wraps.forEach((wrap) => {
          const depth = parseFloat(wrap.dataset.depth || '1');
          const offsetY = baseOffset * depth;
          wrap.style.transform = `translate(0px, ${offsetY.toFixed(2)}px)`;
          wrap.style.opacity = `${opacity}`;
        });
      };

      handleScroll();
      window.addEventListener('scroll', handleScroll, { passive: true });
    }
  }
</script>



<script>
    // 1. 定义字符池
    const CHAR_POOL = ['S', 'E', 'R', 'N', 'A'];
    const SCRAMBLE_SPEED = 300;

    // 2. 获取所有需要交互的字母元素
    const targets = document.querySelectorAll('.scramble-target');

    // 3. 遍历每个元素并添加事件监听
    targets.forEach((element) => {
      const span = element as HTMLElement & { _intervalId?: ReturnType<typeof setInterval> };
    // 1. 保存原始状态
      // 我们把原始字符保存在 dataset 中，方便恢复
      span.dataset.original = span.innerText;

      // 2. 使用 pointer 事件：进入开始扰动，离开立即恢复为原字符
      span.addEventListener('pointerenter', () => {
        // 如果已有定时器，先清除，避免重复
        if (span._intervalId) {
          clearInterval(span._intervalId);
          span._intervalId = undefined;
        }

        // 启动定时器进行字符扰动
        span._intervalId = setInterval(() => {
          const randomIndex = Math.floor(Math.random() * CHAR_POOL.length);
          span.innerText = CHAR_POOL[randomIndex];
        }, SCRAMBLE_SPEED);
      });

      // pointerleave 保证在 pointer 离开元素（包括由子元素引起的）时触发
      span.addEventListener('pointerleave', () => {
        // 清除定时器（如果存在）
        if (span._intervalId) {
          clearInterval(span._intervalId);
          span._intervalId = undefined;
        }

        // 立即恢复为原始字符，确保离开瞬间回到原位
        span.innerText = span.dataset.original ?? '';
      });
    });

  </script>



<style>
  /* 字母进入动画：从四周聚拢并缩放到 1 */
  @keyframes letterEnter {
    0% {
      opacity: 0;
      transform: translate(var(--from-x, 0), var(--from-y, 0)) scale(1.2);
    }
    100% {
      opacity: 1;
      transform: translate(0, 0) scale(1);
    }
  }

  /* SERENA 字母样式 */
  .headline-md {
    font-family: 'Roboto', sans-serif;
    color: rgba(255, 255, 255, 1);
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.5);
    font-size: 1rem; /* 16px */
    line-height: 2.5rem; /* 48px */
    font-weight: 600;
    letter-spacing: 0.8px;
  }

  /* 字母动画 */
  .animate-letter {
    --from-x: 0;
    --from-y: 0;
    opacity: 0;
    animation: letterEnter 0.9s ease-out forwards;
    transform-origin: center;
  }

  /* 聚拢方向配置：从四周进入 */
  #serena-letters .letter-wrap:nth-child(1) .animate-letter {
    --from-x: -140px;
    --from-y: -120px;
  }
  #serena-letters .letter-wrap:nth-child(2) .animate-letter {
    --from-x: 120px;
    --from-y: -140px;
  }
  #serena-letters .letter-wrap:nth-child(3) .animate-letter {
    --from-x: -130px;
    --from-y: 140px;
  }
  #serena-letters .letter-wrap:nth-child(4) .animate-letter {
    --from-x: 140px;
    --from-y: -100px;
  }
  #serena-letters .letter-wrap:nth-child(5) .animate-letter {
    --from-x: -160px;
    --from-y: 150px;
  }
  #serena-letters .letter-wrap:nth-child(6) .animate-letter {
    --from-x: 150px;
    --from-y: 120px;
  }

  /* Letter wrapper: parallax carrier */
  .letter-wrap {
    opacity: 1;
    transition: opacity 0.2s ease-out;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
  }

  /* make sure grid cells keep reasonable size on small screens */
  @media (max-width: 768px) {
    #serena-letters { gap: 3.5rem; }
    .headline-md { font-size: 0.75rem; line-height: 0.8rem; font-weight: 800; }
  }
</style>
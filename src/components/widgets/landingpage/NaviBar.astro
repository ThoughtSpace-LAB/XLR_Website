---
import logoIcon from '~/assets/icons/LOGO.svg?url';
---

<!-- 顶部导航栏：固定定位，白色半透明背景，带边框和阴影 -->
<div class="w-full px-4 py-7 md:px-8 absolute top-0 z-[100] flex justify-center pointer-events-auto">
  <div id="nav-container" class="w-full max-w-4xl h-14 relative opacity-95 bg-white/10 backdrop-blur-xl rounded-[28px] shadow-lg outline outline-1 outline-offset-[-1px] outline-white/25 transition-all duration-500 ease-in-out overflow-hidden pointer-events-auto">
    <!-- 导航内容区：水平排列，左右两侧对齐 -->
    <div class="w-full h-14 flex justify-between items-center px-6 md:px-12 pointer-events-auto">
      <!-- 左侧：Logo 区域 -->
      <a href="/" class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition-opacity">
        <img src={logoIcon} alt="Logo" class="h-6 w-6 object-contain" />
        <span class="brand-logo-letter">SERENA</span>
      </a>
      
      <!-- 右侧：导航链接区域 -->
      <div class="hidden md:flex justify-center items-center gap-16">
        <a href="#feature" class="brand-navi-letter hover:underline">FEATURE</a>
        <a href="/lesson" class="brand-navi-letter hover:underline">LESSON</a>
        <button class="user-guide-btn relative px-6 py-2 flex items-center justify-center bg-white/10 hover:bg-black/20 border border-white/30 hover:border-white/50 rounded-full transition-all duration-300 group">
          <span class="brand-navi-letter text-white font-bold">USER GUIDE</span>
          <span class="ml-1.5 text-white/70 group-hover:text-white group-hover:translate-x-0.5 transition-all duration-300">→</span>
        </button>
      </div>

      <!-- 移动端菜单按钮 -->
      <button id="mobile-menu-btn" class="md:hidden w-9 h-9 flex justify-center items-center bg-white/20 shadow-[inset_0px_2px_4px_0px_rgba(255,255,255,0.5)] rounded-full z-50">
        <span class="text-white text-sm" id="menu-icon">☰</span>
      </button>
    </div>

    <!-- 移动端展开菜单内容 -->
    <div id="mobile-menu" class="w-full md:hidden flex-col items-center justify-center gap-4 pt-6 pb-8 hidden">
      <a href="#feature" class="brand-navi-letter hover:underline mobile-menu-link transition-all duration-300">FEATURE</a>
      <a href="/lesson" class="brand-navi-letter hover:underline mobile-menu-link transition-all duration-300">LESSON</a>
      <button class="user-guide-btn-mobile relative px-6 py-2 flex items-center justify-center bg-white/10 active:bg-white/20 border border-white/30 active:border-white/50 rounded-full transition-all duration-200">
        <span class="brand-navi-letter text-whit">USER GUIDE</span>
        <span class="ml-1.5 text-white/70">→</span>
      </button>
    </div>
  </div>
</div>

<script>
  const setupMobileMenu = () => {
    const btn = document.getElementById('mobile-menu-btn');
    const menu = document.getElementById('mobile-menu');
    const container = document.getElementById('nav-container');
    const icon = document.getElementById('menu-icon');
    
    if (!btn || !menu || !container || !icon) return;

    let isOpen = false;

    btn.addEventListener('click', () => {
      isOpen = !isOpen;
      
      if (isOpen) {
        // Expand container and show menu
        container.style.height = 'auto';
        menu.classList.remove('hidden');
        menu.classList.add('flex');
        
        // Trigger reflow
        void menu.offsetHeight;
        
        // Stagger animation for menu items
        const items = menu.querySelectorAll('.mobile-menu-link, .user-guide-btn-mobile');
        items.forEach((item, index) => {
          setTimeout(() => {
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
          }, 100 + index * 80);
        });
        
        icon.textContent = '✕';
      } else {
        // Reset menu items first
        const items = menu.querySelectorAll('.mobile-menu-link, .user-guide-btn-mobile');
        items.forEach(item => {
          item.style.opacity = '0';
          item.style.transform = 'translateY(-10px)';
        });
        
        // Collapse after animation
        setTimeout(() => {
          menu.classList.remove('flex');
          menu.classList.add('hidden');
          container.style.height = '3.5rem';
        }, 300);
        
        icon.textContent = '☰';
      }
    });
  };

  // Initial setup
  setupMobileMenu();
  
  // Handle view transitions if applicable
  document.addEventListener('astro:after-swap', () => {
    setupMobileMenu();
  });
</script>

<style>
  /* Navi Bar样式 */
  .brand-logo-letter {
    font-family: 'Arimo', sans-serif;
    color: rgba(255, 255, 255, 1);
    font-size: 0.7rem; /* 12px */
    line-height: 0.8rem; /* 16px */
    font-weight: 600;
    letter-spacing: 0.8px;
  }

  .brand-navi-letter {
    font-family: 'Arimo', sans-serif;
    color: rgba(255, 255, 255, 1);
    font-size: 0.8rem; /* 12px */
    line-height: 0.8rem; /* 16px */
    font-weight: 700;
    letter-spacing: 0.4px;
  }

  /* Mobile menu items animation */
  .mobile-menu-link,
  .user-guide-btn-mobile {
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  /* Container smooth height transition */
  #nav-container {
    transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
</style>